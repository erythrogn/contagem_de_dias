{% extends 'base.html' %}

{% block title %}Viagens · tamo junto{% endblock %}

{% block styles %}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/viagens.css') }}">
{% endblock %}

{% block content %}
<div class="wrap">

  <header class="page-header">
    <p class="eyebrow">lugares para explorar juntos</p>
    <h1 class="page-title">Nossa lista de<br><em>Viagens</em></h1>
    <p class="page-sub">sonhos, planos e aventuras compartilhadas</p>
  </header>

  <div class="stats-bar" id="statsBar">
    <div class="stat">
      <div class="stat-num total" id="s-total">0</div>
      <div class="stat-label">total</div>
    </div>
    <div class="stat">
      <div class="stat-num sonho" id="s-sonho">0</div>
      <div class="stat-label">sonhos</div>
    </div>
    <div class="stat">
      <div class="stat-num plan" id="s-plan">0</div>
      <div class="stat-label">planejadas</div>
    </div>
    <div class="stat">
      <div class="stat-num feita" id="s-feita">0</div>
      <div class="stat-label">feitas</div>
    </div>
  </div>

  <section class="form-section">
    <div class="form-heading">nova viagem</div>
    <div class="form-grid">
      <div class="form-group">
        <label>destino</label>
        <input type="text" id="fDest" placeholder="ex: Lisboa, Portugal">
      </div>
      <div class="form-group">
        <label>período estimado</label>
        <input type="text" id="fData" placeholder="ex: julho 2026">
      </div>
      <div class="form-group">
        <label>status</label>
        <select id="fStatus">
          <option value="sonho">✦ sonho</option>
          <option value="planejada">◎ planejada</option>
          <option value="feita">✓ já fomos!</option>
        </select>
      </div>
      <div class="form-group">
        <label>quem quer mais ir?</label>
        <input type="text" id="fQuem" placeholder="ex: os dois, mozi, eu...">
      </div>
      <div class="form-group span2">
        <label>o que queremos fazer lá</label>
        <textarea id="fNotes" placeholder="restaurantes, pontos turísticos, vontades..."></textarea>
      </div>
    </div>
    <button class="btn-submit" onclick="addTrip()">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
        <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
      </svg>
      Adicionar Viagem
    </button>
  </section>

  <div class="filter-row">
    <button class="ftab active" onclick="setFilter('all',this)">todas</button>
    <button class="ftab" onclick="setFilter('sonho',this)">sonhos</button>
    <button class="ftab" onclick="setFilter('planejada',this)">planejadas</button>
    <button class="ftab" onclick="setFilter('feita',this)">feitas ✓</button>
  </div>

  <div class="trip-list" id="tripList"></div>

</div>

<script>
  const STATUS_ICON  = { sonho: '✦', planejada: '◎', feita: '✓' };
  const STATUS_LABEL = { sonho: '✦ sonho', planejada: '◎ planejada', feita: '✓ feita' };
  const STATUS_CLASS = { sonho: 'badge-sonho', planejada: 'badge-planejada', feita: 'badge-feita' };

  let trips  = JSON.parse(localStorage.getItem('tj_trips') || '[]');
  let filter = 'all';

  function save() { localStorage.setItem('tj_trips', JSON.stringify(trips)); }

  function updateStats() {
    document.getElementById('s-total').textContent = trips.length;
    document.getElementById('s-sonho').textContent = trips.filter(t => t.status === 'sonho').length;
    document.getElementById('s-plan').textContent  = trips.filter(t => t.status === 'planejada').length;
    document.getElementById('s-feita').textContent = trips.filter(t => t.status === 'feita').length;
  }

  function render() {
    const list = document.getElementById('tripList');
    list.innerHTML = '';
    const filtered = trips.filter(t => filter === 'all' || t.status === filter);

    if (!filtered.length) {
      list.innerHTML = `
        <div class="empty-state">
          <strong>✈</strong>
          ${filter === 'all' ? 'nenhuma viagem ainda... comecem a sonhar juntos!' : 'nada nessa categoria ainda.'}
        </div>`;
      return;
    }

    filtered.forEach(t => {
      const card = document.createElement('div');
      card.className = 'trip-card';
      card.dataset.status = t.status;
      card.innerHTML = `
        <div class="trip-icon">${STATUS_ICON[t.status]}</div>
        <div class="trip-body">
          <div class="trip-dest">${t.dest}</div>
          <div class="trip-meta">${t.data ? t.data + ' · ' : ''}${t.quem ? 'sugestão: ' + t.quem : ''}</div>
          ${t.notes ? `<div class="trip-notes">${t.notes}</div>` : ''}
          <span class="status-badge ${STATUS_CLASS[t.status]}">${STATUS_LABEL[t.status]}</span>
        </div>
        <div class="trip-actions">
          <button class="btn-icon" title="remover" onclick="removeTrip('${t.id}')">✕</button>
        </div>
      `;
      list.appendChild(card);
    });

    updateStats();
  }

  function addTrip() {
    const dest = document.getElementById('fDest').value.trim();
    if (!dest) { document.getElementById('fDest').focus(); return; }
    trips.unshift({
      id:     Date.now().toString(),
      dest,
      data:   document.getElementById('fData').value.trim(),
      status: document.getElementById('fStatus').value,
      quem:   document.getElementById('fQuem').value.trim(),
      notes:  document.getElementById('fNotes').value.trim(),
    });
    save(); render();
    ['fDest','fData','fQuem','fNotes'].forEach(id => document.getElementById(id).value = '');
  }

  function removeTrip(id) {
    trips = trips.filter(t => t.id !== id);
    save(); render();
  }

  function setFilter(f, btn) {
    filter = f;
    document.querySelectorAll('.ftab').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    render();
  }

  render();
  updateStats();
</script>
{% endblock %}